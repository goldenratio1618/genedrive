# Installation instructions

The simulator and scripts contained here require an installation of Python 3.
It is recommended to use Anaconda Python (https://www.continuum.io/downloads)
as this installs all dependencies of this code.

It is also recommended to create a dedicated directory for storing the data generated by these scripts, to avoid cluttering the installation directory (which is the default data location).

This code has been tested on the Windows 10/Anaconda 4.1.1 and Ubuntu 16.04/Anaconda 4.3.1 environments, but it is designed to be portable so it should work in other environments as well.

# Execution instructions

The executable files are <code>main.py</code>, <code>generate_sample_graphs.py</code>, and <code>fixation_probability_complete_graph.py</code>.
The other files (<code>simulate.py</code>, <code>cmdline.py</code>, and <code>gridtools.py</code> contain functions and classes needed for the simulator.)

## <code>main.py</code>
This program simulates biased sexual reproduction in spatially-structured populations.
Note that it uses a frequency-dependent selection with complex payoff framework, so there will be one individual reproducing, but it may produce offspring of the opposite type.


### Simulation Parameters
The gene-drive payoff matrix contains three parameters: the mutant homozygote fitness a, the wild-type fitness FB, and the gene-drive probability p. They can be changed with the <code>-a</code>, <code>-fb</code>, and <code>-p</code> flags, respectively. Default values are a=1, FB=2, and p=1.

The default replacement policy is to use the graph replacement probability distribution (that is, select a neighbor of the individual chosen to reproduce). However, this can be changed to the random replacement distribution (that is, the replaced individual is chosen at random out of the entire graph) by specifying the <code>-rp</code> argument.

The accuracy of the simulation can be changed using the <code>-n</code> argument, which controls the number of simulations that are run to estimate the fixation probability. The default is to run 100 simulations, but it is often useful to run more for higher accuracy.

### Graph
The <code>main.py</code> program has many command-line arguments relating to the graph structure. If they are all left blank, the default behavior is to use a 15x15 8-regular lattice, which has toroidal boundary conditions. However, the size of this graph can be customized using the <code>-r</code> and <code>-c</code> arguments.
Thus, <code>main.py -r 10 -c 20</code> will use a 10x20 8-regular graph.

If the <code>-fr</code> argument is specified, the program will use a 4-regular lattice instead of an 8-regular lattice. Either of these lattices can be modified to be a Watts-Strogatz small-world network <cite>(Watts & Strogatz, 1998)</cite> by using the <code>-s</code> argument, which specifies the probability that each edge will be replaced with a random edge.
By using the <code>-h</code> parameter, the heterogeneity of the small-world network can be changed, as described in (Fu, Liu, & Wang, 2007).

In addition to lattices and small-world networks, custom graphs can be specified using the
<code>-gf</code> argument, which allows the user to specify a file containing a list of edges. The vertices are assumed to be integers and the edges are to be listed as pairs A,B. For instance, the line 5,10 would specify an edge from vertex 5 to vertex 10. Undirected edges need to be specified as two lines, e.g. 5,10 and 10,5.

### Plotting Fixation Probabilities
The program has the ability to change a parameter and plot the fixation probability as a function of that parameter by using the <code>-pl</code> argument. Currently, the parameters available to plot are the mutant homozygote fitness a, the wild-type fitness FB, the gene-drive probability p, the small-world coefficient s, and the small-world heterogeneity h.

The range of the plot will be from the <code>-min</code> argument (default 0) to the input value of the chosen parameter. The number of points to be plotted is given by the <code>-np</code> argument (default 51). For example,
<code>main.py -pl fb -fb 4 -min 0.1 -np 40</code> will plot fixation probability vs. FB for FB = 0.1, 0.2, 0.3, ..., 4.0.
When plotting against the FB parameter, it is strongly recommended to set <code>-min</code> to a nonzero value, as otherwise at initialization (when there is one mutant), all fitnesses will be 0 and the simulation cannot progress.

### Binary Search
The program also has the ability to binary search on the FB argument in order to find FB*. This is turned on using the <code>-b</code> flag. If used in conjunction with the <code>-p</code> flag, the program will run a separate instance of binary search for each value of the plotting parameter, and it will then plot FB* (not fixation probability) vs that parameter. It is not possible to plot FB while running binary search, so <code>-p fb -b</code> is an illegal argument list.

### Output
The program can output in a variety of different ways. By default, it will simply print the calculated fixation probability and average time to fixation and exit; if a plot or binary search was in effect, it will print them for each parameter value. However, using the <code>-o</code> argument, the program can be made to output to a file as well. If <code> -o 1</code> is specified, the program will print the fixation probabilities to a file (in addition to standard output). If <code> -o 2</code> is specified, the program will also output a file containing the time to fixation for each simulation.
We are currently working on implementing additional output options, such as outputting the number of mutants at each time step in each simulation.

By default, the program will create a timestamp-named directory in the current working directory and put all of the output in there. However, it may be desirable to have the output somewhere else to avoid cluttering the working directory. To this end, the <code>-of</code> argument can be used to redirect the output into a folder of choice. Note that the presence or absence of a slash / at the end of the <code>-of</code> makes a difference:

<code> python main.py -o 1 -of "some_dir/" </code> will create a timestamp-named directory within <code>some_dir</code>
<code> python main.py -o 1 -of "some_dir" </code> will create a timestamp-named directory named, for instance, <code>some_dir03-17-2017_12-47-55</code>

### Examples
Some useful code examples that can used to produce some of the plots in the senior thesis:

<code>python main.py -o 1 -n 2000 -fb 4 -pl a -np 11 -b -of '8_regular_lattice'</code> will produce a plot of critical wild-type fitness FB* vs. mutant homozygote fitness a for a 15x15 8-regular lattice.
<code>python main.py -rp -o 1 -n 200 -fb 4 -pl fb -gf 'sample_graphs/circle_100.txt' -of '2_cycle_randomreplace'</code> will produce a plot of fixation probability vs. wild-type fitness FB for a 100-cycle using the random placement probability distribution.

## <code>generate_sample_graphs.py</code>
As its name suggests, this program has the ability to generate graphs, with the intention that they can be fed to <code>main.py</code>. It has the ability to generate four types of graphs: directed line graphs, circle graphs (aka cycles), complete graphs, and double-complete graphs. An **nxn-double-complete graph** consists of n separate n-complete graphs. One vertex is chosen out of each complete graph, and these vertices are connected together to form another complete graph.

### Usage
This file has three arguments: <code>-t</code> specifies the type of graph to be generated, <code>-n</code> specifies its size, and <code>-f</code> specifies the output directory into which the new graph file is to be placed. For example:

<code> python generate_sample_graphs.py -t doublecomplete -n 10 </code> will generate an nxn double-complete graph and place it in the <code>sample_graphs</code> folder (which is assumed to exist).

<code> python generate_sample_graphs.py -t circle -n 100 -f test_graphs/</code> will generate an n-cycle and place it in the <code>test_graphs</code> directory.

## <code>fixation_probability_complete_graph.py</code>
This program uses the analytical product formula for the fixation probability on a complete graph as a function of the payoff matrix parameters a, b, and c, as well as the initial number of mutants i, and the total graph size n. Each of these can be specified using their respective flags, e.g. <code>-c 5</code> will set c=5.

By specifying the <code>-p</code> option, this program will generate a plot of fixation probability against the specified parameter (e.g. <code>-p n</code> will generate fixation probability vs. n). The parameter range is always 0 to its stated value, or i to its stated value in the case of n. Here "stated value" is the value of the parameter that was passed in as a command-line argument (or its default value if no such argument was passed). Default values are 1, 2, 4, 10, and 1 for a, b, c, n, and i, respectively.

The <code>-step</code> argument can be specified when plotting is enabled; it sets the step between consecutive points in the plot.

# References

Fu, F., Liu, L.-H., & Wang, L. (2007). Evolutionary Prisoner's Dilemma on heterogeneous Newman-Watts small-world network. The European Physical Journal B, 367-372.

Watts, D. J., & Strogatz, S. H. (1998). Collective dynamics of 'small-world' networks. Nature, 440-442.

